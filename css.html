<style>
/* ===== iOS 亮色（含玻璃） ===== */
[hidden]{ display:none !important; }
    :root{
      --bg: #ffffff;
      --fg: #0b0b0f;
      --muted: #6b7280;
      --line: rgba(60,60,67,0.18);
      --tint: #0a84ff;
      --tint-pressed: #0066cc;

      --card: rgba(255,255,255,0.68);
      --card-blur: blur(18px) saturate(160%);
      --shadow: 0 18px 40px rgba(0,0,0,.06), 0 1px 0 rgba(0,0,0,.04) inset;

      --field-bg: rgba(255,255,255,0.98);
      --field-border: rgba(60,60,67,0.18);
      --tag-bg: rgba(255,255,255,0.98);

      --ink-income-bg: rgba(10,132,255,.10);
      --ink-income-border: rgba(10,132,255,.28);
      --ink-expense-bg: rgba(255,59,48,.08);
      --ink-expense-border: rgba(255,59,48,.24);
      --ink-balance-bg: rgba(52,199,89,.10);
      --ink-balance-border: rgba(52,199,89,.28);

      /* 左側 sort 寬度 */
      --flt-w: 120px;
      --ico-bg: var(--field-bg);
      --ico-border: var(--field-border);
    }
    @media (max-width: 1024px){ :root{ --flt-w: 110px; } }

    /* ===== 暗色 ===== */
    html[data-theme="dark"]{
      color-scheme: dark;
      --bg: #0f0f12; --fg: #f5f5f7; --muted: #a1a1aa; --line: rgba(255,255,255,0.14);
      --card: rgba(26,26,28,0.68); --card-blur: blur(18px) saturate(140%); --shadow: 0 20px 44px rgba(0,0,0,.45), 0 1px 0 rgba(255,255,255,.04) inset;
      --field-bg: rgba(36,36,38,0.9); --field-border: rgba(255,255,255,0.08); --tag-bg: rgba(40,40,42,0.9);
      --ink-income-bg: rgba(10,132,255,.22); --ink-income-border: rgba(10,132,255,.55);
      --ink-expense-bg: rgba(255,69,58,.22); --ink-expense-border: rgba(255,69,58,.55);
      --ink-balance-bg: rgba(48,209,88,.22); --ink-balance-border: rgba(48,209,88,.55);
    }
    html[data-theme="dark"] #sumTotal,
    html[data-theme="dark"] #sumBalanceAll{
      background:#fff; color:#111;
    }
    html, body { height: 100%; }
    body {
      margin: 0;
      -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "SF Pro Display", "Segoe UI", Roboto, "Noto Sans", "PingFang TC", "Microsoft JhengHei", sans-serif;
      color: var(--fg);
      background:
        radial-gradient(1200px 800px at 0% -10%, rgba(10,132,255,.06), transparent 60%),
        radial-gradient(1000px 700px at 100% 110%, rgba(52,199,89,.06), transparent 60%),
        linear-gradient(to bottom, var(--bg), var(--bg));
    }

    .app { display:flex; min-height: 100dvh; }

    /* ===== 右側抽屜（主選單） ===== */
    .sidebar{
      position: fixed; top:0; right:0; bottom:0; width: 280px;
      background: var(--card);
      -webkit-backdrop-filter: var(--card-blur); backdrop-filter: var(--card-blur);
      border-left: 1px solid var(--line);
      box-shadow: var(--shadow);
      transform: translateX(100%); transition: transform .25s ease;
      z-index: 30; padding: 18px 14px;
    }
    .sidebar.open{ transform: translateX(0); }
    .sb-head{ display:flex; align-items:center; justify-content:space-between; margin: 2px 6px 12px; }
    .sb-title{ font-weight:800; letter-spacing:-.01em; font-size: 26px; }
    .sb-close{
      border:1px solid var(--line); background: var(--field-bg); color: var(--fg);
      border-radius: 999px; padding: 6px 10px; font-size: 13px; cursor:pointer;
    }
    .sb-group{ margin: 8px 0; }
    .sb-link{
      display:flex; align-items:center; gap:10px;
      padding: 12px 14px; margin: 6px 0; border-radius: 14px;
      text-decoration:none; color: var(--fg); border:1px solid transparent;
      background: var(--field-bg); cursor:pointer; font-size: 16px; font-weight:700;
    }
    .sb-link:hover{ filter: brightness(0.98); }
    .sb-link.active{ outline: 2px solid var(--tint); }
    .sb-foot{ margin-top: 16px; font-size: 12px; color: var(--muted); }

    .content{ flex:1; min-width:0; width:100%; }

    .topbar{
      display:grid; grid-template-columns: 1fr auto; grid-template-areas:
        "left right"
        "center center";
      gap:6px;
      padding: 14px 16px; position: sticky; top:0; z-index: 10;
      background: color-mix(in oklab, var(--bg) 90%, white);
      border-bottom: 1px solid var(--line);
      -webkit-backdrop-filter: blur(10px); backdrop-filter: blur(10px);
    }
    .topbar-row{ display:flex; align-items:center; justify-content:space-between; grid-area: left / left / left / right; }
    .large-title{ font-size: clamp(22px, 4vw, 30px); font-weight: 800; letter-spacing: -0.02em; margin: 0 6px; }
    .subtitle{ color: var(--muted); font-weight: 600; font-size: 14px; }
    .rightbar{ display:flex; gap:10px; align-items:center; }
    .menu-btn{
      border:1px solid var(--line); background: var(--field-bg); color: var(--fg);
      border-radius: 12px; padding: 8px 12px; font-size: 14px; cursor:pointer;
    }
    .theme-toggle{ display:flex; gap:6px; align-items:center; }
    .seg-sm{ display:flex; gap:6px; }
    .seg-sm button{
      border:1px solid var(--line); background: var(--field-bg); color: var(--fg);
      border-radius: 12px; padding: 6px 10px; font-size: 13px; cursor:pointer;
    }
    .seg-sm button.active{ background: var(--tint); color: #fff; border-color: transparent; box-shadow: 0 4px 10px rgba(10,132,255,.25); }

    .topbar-center{
      grid-area: center;
      display:flex; align-items:center; justify-content:center; gap:12px;
      font-weight: 800; letter-spacing:-.01em;
    }
    .page-name{ font-size: 16px; color: var(--muted); }
    .wrap{ max-width: 1280px; margin: 0 auto; padding: 16px; }
    .card{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 22px;
      padding: clamp(14px, 3vw, 20px);
      box-shadow: var(--shadow);
      margin: 12px auto;
      -webkit-backdrop-filter: var(--card-blur); backdrop-filter: var(--card-blur);
    }

    .row { display:flex; gap: 12px; }
    .col { flex:1; min-width: 0; display: flex; flex-direction: column; }
    @media (max-width: 1024px){ .row { flex-direction: column; } }

    label{ font-size: 13px; color: var(--muted); margin: 2px 2px 6px; font-weight: 600; }
    input[type="date"],
    input[type="text"],
    input[type="number"],
    select{
      appearance: none; background: var(--field-bg); color: var(--fg);
      border: 1px solid var(--field-border); border-radius: 16px;
      padding: 12px 14px; font-size: 16px; outline: none;
      transition: box-shadow .2s ease, border-color .2s ease;
      box-shadow: 0 1px 0 rgba(255,255,255,.35) inset, 0 1px 2px rgba(0,0,0,.06);
    }
    input:focus, select:focus{ border-color: rgba(10,132,255,.45); box-shadow: 0 0 0 4px rgba(10,132,255,.16); }

    .seg{ display:flex; border:1px solid var(--field-border); border-radius: 14px; padding: 3px; background: var(--field-bg); }
    .seg input{ display:none; }
    .seg label{ flex:1; text-align:center; padding:10px 8px; border-radius: 10px; font-weight: 700; cursor: pointer; }
    .seg input:checked + label{ background: var(--tint); color: white; box-shadow: 0 6px 14px rgba(10,132,255,.25); }

    .btn{
      border: none; border-radius: 16px; padding: 12px 18px; font-size: 16px; font-weight: 700;
      background: var(--tint); color: white; box-shadow: 0 8px 18px rgba(10,132,255,.25), 0 1px 0 rgba(255,255,255,.3) inset;
      transition: transform .06s ease, background .2s ease, opacity .2s ease; cursor: pointer;
    }
    .btn:active{ transform: translateY(1px) scale(.99); background: var(--tint-pressed); }
    .btn:disabled{ opacity: .6; cursor: not-allowed; }
    .actions{ display:flex; gap:10px; align-items:center; margin-top: 16px; }
    #msg{ flex:1; min-height: 46px; display:flex; align-items:center; padding: 10px 12px; border: 1px solid var(--line); border-radius: 16px; background: var(--tag-bg); font-size: 14px; }
    @media (max-width: 1024px){ .actions{ flex-direction: column; align-items: stretch; } .btn{ width: 100%; } }

    /* KPI */
    .ink{ display:grid; grid-template-columns: repeat(3, minmax(180px,1fr)); gap: 14px; margin: 6px 0 4px; }
    .ink-card{ border-radius: 16px; padding: 16px; border: 1px solid var(--line); box-shadow: var(--shadow); }
    .ink-income{ background: var(--ink-income-bg); border-color: var(--ink-income-border); }
    .ink-expense{ background: var(--ink-expense-bg); border-color: var(--ink-expense-border); }
    .ink-balance{ background: var(--ink-balance-bg); border-color: var(--ink-balance-border); }
    .ink-label{ font-size: 13px; color: var(--muted); margin-bottom: 6px; }
    .ink-value{ font-weight: 800; font-size: clamp(20px, 3.8vw, 26px); letter-spacing: -.01em; overflow-wrap:anywhere; max-width:100%; }

    /* 表格與圖表 */
    .meta-row{ display:flex; align-items:center; justify-content:space-between; margin-bottom:8px; color:var(--muted); }
    table{ width:100%; border-collapse: collapse; font-size: 14px; }
    th, td{ padding:12px 10px; border-bottom: 1px solid var(--line); text-align:left; }
    th{ color: var(--muted); font-weight:700; cursor: pointer; user-select: none; }
    .t-right{ text-align:right; white-space:nowrap; }

    .grid-2-tight{ display:grid; grid-template-columns: 1fr 2fr; gap: 12px; }
    .grid-2-tight > *{ min-width:0; }
    @media (max-width: 1024px){ .grid-2-tight{ grid-template-columns: 1fr; } }
    .charts-compact{ height: 25vh; min-height: 200px; }
    canvas{ width: 100%; height: 100%; }

    /* 品牌色 */
    :root{ --moss: #2f6d3a; --moss-ink: #24562d; }
    html[data-theme="dark"]{ --moss: #86c28f; --moss-ink: #a8dbb0; }

    /* 左側 sort 抽屜（分析頁） */
    .flt-toggle{
      position: fixed; top:50%; transform:translateY(-50%);
      left: 6px; z-index: 35;
      border: 1px solid var(--line);
      background: var(--field-bg);
      -webkit-backdrop-filter: var(--card-blur); backdrop-filter: var(--card-blur);
      border-radius: 999px;
      padding: 8px 10px;
      font-size: 12px; font-weight: 700; color: var(--fg);
      box-shadow: var(--shadow); cursor: pointer;
    }
    .flt-toggle small{ opacity:.6; margin-left:4px; }

    .flt-drawer{
      position: fixed; left: 0; top: 64px; bottom: 0;
      width: var(--flt-w);
      transform: translateX(-100%); transition: transform .25s ease;
      background: var(--card);
      border-right: 1px solid var(--line);
      -webkit-backdrop-filter: var(--card-blur); backdrop-filter: var(--card-blur);
      box-shadow: var(--shadow); z-index: 34; padding: 12px;
    }
    .flt-drawer.open{ transform: translateX(0); }
    .flt-title{ font-weight:800; margin: 2px 0 10px; letter-spacing:-.01em; }
    .flt-group{ margin: 10px 0 14px; }
    .flt-drawer.flt-fixed .flt-title{ font-size: 16px; }
    .flt-drawer.flt-fixed .chips.vertical .chip{ width:auto; display:inline-block; }
    .flt-label{ font-size:12px; color:var(--muted); margin-bottom:6px; }
    /* 當以固定卡片呈現（JS 會加上 .flt-fixed 與 .card） */
    .flt-drawer.flt-fixed{
      position: static;
      transform: none;
      width: auto;
      max-width:600px;
      margin: 0 auto 12px;   /* 置中並與卡片同節奏 */
      border-right: 1px solid var(--line);
      border-radius: 22px;
      padding: clamp(12px, 2vw, 16px);
    }
    .segmulti{ display:flex; gap:6px; flex-wrap:wrap; }
    .segmulti .segbtn{
      border:1px solid var(--field-border);
      background: var(--field-bg); color: var(--fg);
      border-radius: 12px; padding: 6px 10px; font-size: 12px; cursor:pointer;
    }
    .segmulti .segbtn.active{
      background: var(--tint); color: #fff; border-color: transparent;
      box-shadow: 0 4px 10px rgba(10,132,255,.25);
    }
    .chips{ display:flex; gap:6px; flex-wrap:wrap; }
    .chips.vertical .chip{
      display:block; width:100%; text-align:left; margin-bottom:6px;
      border:1px solid var(--field-border); background: var(--field-bg);
      color: var(--fg); border-radius: 999px; padding: 6px 8px;
      font-size: 12px; cursor:pointer;
    }
    .chip.active{
      background: color-mix(in oklab, var(--tint) 92%, white);
      color: #fff; border-color: transparent; box-shadow: 0 4px 10px rgba(10,132,255,.25);
    }

    /* sticky 圖表（可收合） */
    .data-sticky{ position: sticky; top: 64px; z-index: 5; margin: 10px auto 12px; padding: 10px 12px; }
    .data-sticky.collapsed .grid-2-tight{ display:none; }
    .chart-placeholder{
      display:none; align-items:center; justify-content:center;
      height: 42px; border: 1px dashed var(--line); border-radius: 12px;
      background: var(--tag-bg); color: var(--muted); font-weight:700; cursor:pointer;
    }
    .data-sticky.collapsed .chart-placeholder{ display:flex; }
    .chart-actions{ display:flex; justify-content:flex-end; margin-top:8px; }
    .chart-toggle-btn{
      border:1px solid var(--line); background: var(--field-bg); color: var(--fg);
      border-radius: 12px; padding: 6px 10px; font-size: 13px; cursor:pointer;
    }

    /* 抽屜開啟時：右側內容右移 + 留 14px 間距 */
    #form_data.flt-shift{ margin-left:0; }

    /* 自適應比例的 logo 容器 */
.logo-box{
  /* 預設寬：原本 180px 的 2 倍 = 360px；同時做點響應式保護 */
  --logo-w: 360px;
  --logo-ar: 16/9;   /* 預設比例，真正比例由 JS 於載入後覆蓋 */
  --logo-radius: 16px;
  --logo-zoom: 1;    /* 如需只放大影像而不改容器，可設 >1（下面 JS 我們用放大尺寸，不用 zoom） */

  width: min(var(--logo-w), 90%);
  aspect-ratio: var(--logo-ar);
  margin: 0 auto 16px;
  border-radius: var(--logo-radius);
  overflow: hidden;

  /* 原來的玻璃與陰影保留 */
  background: linear-gradient(180deg, rgba(10,132,255,.08), rgba(10,132,255,0));
  box-shadow: inset 0 1px 0 rgba(255,255,255,.25), 0 10px 24px rgba(0,0,0,.08);
  -webkit-backdrop-filter: blur(10px);
  backdrop-filter: blur(10px);

  display:flex; align-items:center; justify-content:center;
}

/* 圖片鋪滿容器但不裁切（保持完整） */
#infoLogo{
  width: 100%;
  height: 100%;
  object-fit: contain;    /* 想要滿版可改 cover */
  display: none;          /* 載到才顯示（JS 會打開） */
  transform: scale(var(--logo-zoom));
  transform-origin: center;
  border-radius: var(--logo-radius); /* 讓圓角完全吻合 */
}

/* 資訊頁：以 logo 做為全幅模糊背景（Apple 霧面玻璃風） */
#form_info{
  position: relative;
  isolation: isolate;           /* 確保內外層疊影不互相影響 */
  border-radius: 22px;          /* 和 .wrap 內卡片圓角氛圍一致 */
  overflow: hidden;             /* 防止模糊層外溢 */
}

/* 全屏背景：logo 圖模糊鋪滿 */
body::before{
  content: "";
  position: fixed;   /* 固定整個視窗 */
  inset: 0;
  background-image: var(--hero-img, none);
  background-size: cover;
  background-position: center;
  filter: blur(28px) saturate(130%);
  transform: scale(1.15);
  will-change: transform, filter;
  z-index: -2;       /* 永遠在最底層 */
}

/* 疊加亮化/暗化層，避免文字看不清楚 */
body::after{
  content: "";
  position: fixed;
  inset: 0;
  background:
    radial-gradient(120% 80% at 50% -20%, rgba(255,255,255,.28), transparent 55%),
    radial-gradient(120% 80% at 50% 120%, rgba(255,255,255,.22), transparent 55%),
    linear-gradient(to bottom, rgba(255,255,255,.28), rgba(255,255,255,.18));
  z-index: -1;
  opacity: var(--hero-overlay-alpha, .9);
}

/* 暗色模式：換成暗色遮罩 */
html[data-theme="dark"] body::after{
  background:
    radial-gradient(120% 80% at 50% -20%, rgba(0,0,0,.38), transparent 55%),
    radial-gradient(120% 80% at 50% 120%, rgba(0,0,0,.34), transparent 55%),
    linear-gradient(to bottom, rgba(0,0,0,.38), rgba(0,0,0,.28));
}

/* 暗色模式：改用暗化疊色，降低亮度避免刺眼 */
html[data-theme="dark"] #form_info::after{
  background:
    radial-gradient(120% 80% at 50% -20%, rgba(0,0,0,.38), transparent 55%),
    radial-gradient(120% 80% at 50% 120%, rgba(0,0,0,.34), transparent 55%),
    linear-gradient(to bottom, rgba(0,0,0,.38), rgba(0,0,0,.28));
  opacity: var(--hero-overlay-alpha, .9);
}

/* 卡片本身已經有玻璃感，為了更像 iOS 可微增強 */
#form_info .card{
  -webkit-backdrop-filter: blur(14px) saturate(120%);
  backdrop-filter: blur(14px) saturate(120%);
  background: color-mix(in oklab, var(--card) 86%, transparent);
}
/* 保險：避免某處對組成卡片設了 max-width */
#form_info .card:has(#catbar-track){ max-width: none; }

/* 讓地址所在資訊卡可以更寬一些 */
.card.is-wide{ max-width: 1100px; margin-left:auto; margin-right:auto; }


/* ===== 分析頁：精簡加總列 ===== */
.sumbar{
  display:flex; align-items:center; justify-content:space-between;
  gap:10px;
  padding: 8px 12px;            /* 薄一點，避免佔高 */
  border-radius: 16px;
  background: var(--card);
  border: 1px solid var(--line);
  box-shadow: var(--shadow);
  margin: 12px auto;            /* 與清單同寬（放在 wrap > .card 前面） */
}
.sum-left{
  display:flex; gap:6px; flex-wrap:wrap; align-items:center;
  min-height: 26px;             /* 小小一條就好 */
}
.sum-tag{
  display:inline-flex; align-items:center; gap:6px;
  padding: 4px 8px;
  border-radius: 999px;
  font-size: 12px; font-weight: 700;
  border:1px solid var(--field-border);
  background: var(--field-bg); color: var(--fg);
  cursor: pointer;
}
.sum-tag:hover{ filter: brightness(0.97); }
.sum-tag .x{
  font-weight: 900; opacity:.6; line-height:1; transform: translateY(-.5px);
}
.sum-right{
  font-weight: 900; font-size: 16px; white-space: nowrap;
}
.sum-right-block{ display:inline-flex; align-items:center; gap:6px; }
.sum-sep{ opacity:.5; margin: 0 6px; }

/* 沒有特定類別時（等於全部）顯示灰色徽章 */
.sum-tag.is-all{
  cursor: default;
  opacity:.72;
}

/* 日期 pill（小、不外溢） */
.date-field{
  position: relative;
  width: 90px; min-width: 90px;
  border: 1px solid var(--field-border);
  background: var(--field-bg);
  border-radius: 10px;
  height: 30px;
  display:flex; align-items:center; justify-content:center;
  box-shadow: 0 1px 0 rgba(255,255,255,.25) inset;
}

.date-display{
  font-size: 12px; font-weight:700; letter-spacing:.2px;
  color: var(--fg);
  pointer-events: none;
}

/* 真正的 date input 當透明覆蓋層：可點但不佔視覺寬度 */
.date-field input[type="date"]{
  position:absolute; inset:0;
  opacity:0;          /* 完全透明，仍可點擊呼叫原生日期選擇器 */
  width:100%; height:100%;
  cursor:pointer;
}

/* ---- 修正：抽屜內日期 pill 不超出寬度 ---- */
.flt-drawer .row.date-row{
  gap: 6px;              /* 小一點的間距 */
  flex-wrap: wrap;       /* 允許換行（極窄時可疊成兩行） */
}

.flt-drawer .row.date-row .date-field{
  width: calc(50% - 3px); /* 與 segbtn 一致 */
  min-width: 0;
}

/* 再精簡一下內距與字級，確保小抽屜也穩 */
.flt-drawer .date-field{ height: 28px; }
.flt-drawer .date-display{ font-size: 12px; }

/* ===== 共用：Material Icons（Round） ===== */
.micon{ font-family: 'Material Icons Round', 'Material Icons', system-ui, -apple-system, Segoe UI, Roboto, 'Noto Sans', sans-serif; font-weight: normal; font-style: normal; font-size: 48px; line-height: 1; letter-spacing: normal; text-transform: none; display: inline-block; white-space: nowrap; word-wrap: normal; direction: ltr; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }

/* ===== 手機底部 Tabbar（<=1024px 顯示） ===== */
:root{ --tabbar-h: 220px; }
.tabbar{ position: fixed; left: 0; right: 0; bottom: 0; height: var(--tabbar-h); background: var(--card); border-top: 1px solid var(--line); -webkit-backdrop-filter: var(--card-blur); backdrop-filter: var(--card-blur); box-shadow: 0 -12px 28px rgba(0,0,0,.06); z-index: 40; display: none; }
.tabbar .tab-inner{
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: space-around;
  gap: 0;
  padding: 6px 18px;
}
.tabbar .tab-item{
  width: 108px; height: 108px;
  display: inline-flex; align-items: center; justify-content: center;
  border: 1px solid var(--line);
  background: var(--field-bg); color: var(--fg);
  border-radius: 50%;
  cursor: pointer; text-decoration: none; user-select: none;
  transition: transform .08s ease, background .2s ease, box-shadow .2s ease;
  box-shadow: 0 2px 0 rgba(255,255,255,.3) inset, 0 6px 14px rgba(0,0,0,.04);
}
.tabbar .tab-item:active{ transform: translateY(1px) scale(.98); }
.tabbar .tab-item.active{
  background: var(--tint); color: #fff; border-color: transparent;
  box-shadow: 0 8px 18px rgba(10,132,255,.25);
}
.tabbar .tab-label{ display: none; } /* 以 icon 為主，保留 label 以後擴充 */

/* 頁面內容在手機時預留底部高度，避免被 tabbar 蓋住 */
@media (max-width: 1024px){
  .has-tabbar .content{ padding-bottom: calc(var(--tabbar-h) + 14px); }
  .tabbar{ display: block; }
}

/* ===== 側邊抽屜在手機版關閉 ===== */
@media (max-width: 1024px){
  .sidebar{ display: none !important; }
}

/* ===== Menu 子選單（預留樣式；之後用 JS 控制開關） ===== */
.menu-sheet{ position: fixed; left: 0; right: 0; bottom: 0; transform: translateY(100%); transition: transform .25s ease; background: var(--card); border-top-left-radius: 18px; border-top-right-radius: 18px; border: 1px solid var(--line); -webkit-backdrop-filter: var(--card-blur); backdrop-filter: var(--card-blur); box-shadow: 0 -16px 40px rgba(0,0,0,.22); z-index: 45; padding: 14px; }
.menu-sheet.open{ transform: translateY(0); }
.menu-grid{ display: grid; grid-template-columns: repeat(4, minmax(0,1fr)); gap: 10px; }
.menu-btn{ display:flex; align-items:center; justify-content:center; height: 54px; border:1px solid var(--line); background: var(--field-bg); color: var(--fg); border-radius: 14px; cursor: pointer; transition: transform .08s ease, background .2s ease; }
.menu-btn:active{ transform: translateY(1px) scale(.98); }
.menu-btn .micon{ font-size: 22px; }

/* === KPI 右側「共 N 筆」膠囊（JS 會插入 .kpi-pill） === */
.kpi-pill{
  display:inline-block;
  padding: 2px 8px;
  border-radius: 999px;
  font-size: 12px; line-height: 1.1;
  border:1px solid currentColor;
  opacity:.85;
}

/* === 支出組成 legend 預設樣式（若無 inline style 也能看） === */
.legend-item{ display:inline-flex; align-items:center; gap:6px; font-size: 13px; }
.legend-item .dot{
  width:10px; height:10px; border-radius:999px; display:inline-block;
  background: var(--muted);
}
/* 組成條（支出/收入通用） */
.catbar{ display:flex; align-items:center; gap:10px; }
.catbar-track{
  flex:1 1 auto; height:14px; border-radius:999px;
  background:color-mix(in oklab, var(--muted) 12%, transparent);
  position:relative; overflow:hidden;
}
.catbar-total{ min-width:92px; text-align:right; font-weight:700; }
.catlegend{ display:flex; flex-wrap:wrap; gap:10px; margin-top:10px; }

/* === 地址複製按鈕（小型 icon 鈕：補 baseline 樣式；JS 已插入） === */
.btn.addr-copy{ padding: 4px 6px; border-radius: 10px; }
.btn.addr-copy .micon{ font-size: 18px; }

/* 類型膠囊（表格用；JS 之後會加 class） */
.pill{ display:inline-block; padding:2px 10px; border-radius:999px; font-size:12px; font-weight:800; letter-spacing:.3px; }
/* 膠囊：紅=支出、黃=收入 */
.pill-expense{ color:#ff3b30; background: color-mix(in oklab, #ff3b30 14%, transparent); border:1px solid color-mix(in oklab, #ff3b30 34%, transparent); }
.pill-income{ color:#9c7a00; background: color-mix(in oklab, #ffcc00 22%, transparent); border:1px solid color-mix(in oklab, #ffcc00 40%, transparent); }
.pill-neutral{ color:#1e90ff; background: color-mix(in oklab, #1e90ff 12%, transparent); border:1px solid color-mix(in oklab, #1e90ff 30%, transparent); }
html[data-theme="dark"] .pill-expense{ color:#ff8a80; }
html[data-theme="dark"] .pill-income{ color:#ffd666; }
html[data-theme="dark"] .pill-neutral{ color:#9dc7ff; }

/* ===== 分析頁：兩欄網格（左：篩選｜右：圖表+合計+清單） ===== */
    .data-grid{
      display:grid;
      grid-template-columns: 132px minmax(0, 1fr); /* 左欄對齊 flt-drawer 寬度 */
      gap: 16px;
      align-items: start;
      max-width: 1280px; /* 桌面更寬 */
      margin: 0 auto;
      min-width:0;
    }
    @media (max-width: 1024px){ .data-grid{ grid-template-columns: 1fr; } }
    @media (max-width: 1024px){
      .data-right > .card,
      .data-right > .sumbar{ max-width: 640px; margin-left:auto; margin-right:auto; }
    }
    /* 只要在左欄顯示，就強制以 sticky 呈現，避免覆蓋右側 */
    .data-left .flt-drawer{
      width: 100%; max-width: 132px;
      position: sticky; top: 72px; left: auto; right: auto; bottom: auto;
      transform: none; width: auto;
      z-index: 1;
    }
    .data-right{ z-index: 0; }
#sumTotal, #sumBalanceAll{
  display:inline-block;
  padding: 2px 10px;
  border-radius: 999px;
  background:#fff;
  color:#111;
  border:1px solid var(--line);
  font-weight: 800;
}

/* 右側撐滿且不重疊 */
.data-right > .card,
.data-right > .sumbar{ width: 100%; max-width: 100%; }
.data-right{ min-width:0; }
/* === 合計數字改白色膠囊；全域移除「|」分隔符 === */
.sum-sep{ display:none; }


/* ===== 地址區：雙欄卡片 ===== */
 .addr-grid{
    display:flex; flex-direction: column; gap:12px;
    justify-content:center; align-items:stretch; margin-bottom:14px;
    width:100%; max-width:100%;
  }
  .addr-box{
  flex: 1 1 auto; width:100%; box-sizing:border-box; text-align:left;
  border:1px solid var(--line); background: var(--tag-bg);
  border-radius:14px; padding:10px 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,.04);
  overflow-wrap:anywhere; word-break:break-word;
}
/* 地址行：按鈕固定於右側，文字讓出空間 */
.addr-box{ position: relative; padding-right: 44px; }
.addr-box .addr-copy{ position: absolute; right: 8px; top: 50%; transform: translateY(-50%); }
.addr-box .addr-copy .micon{ font-size: 20px; }
.addr-box > div{ overflow-wrap:anywhere; }

/* ===== KPI 等高：卡片撐滿父層高度 ===== */
  .row{ align-items: stretch; } /* 確保 flex 子項可拉齊 */
  .card.kpi-eq{ display:flex; flex-direction:column; height:100%; min-width:0; }
  .card.kpi-eq .subtitle{ margin-top:auto; }

/* ===== 資訊頁：桌面版左右配置；手機直向堆疊 ===== */
  /* Info: 本月重點（含 .kpi-eq）→ 兩欄大卡 */
  #form_info .card .row:has(.kpi-eq){
    display: grid;
    grid-template-columns: repeat(2, minmax(340px, 1fr));
    gap: 14px;
  }
  #form_info .card .row:has(.kpi-eq) .col{ width: auto; }
  .card.kpi-eq{ min-height: 70px; }

  @media (max-width: 1024px){
    #form_info .card .row:has(.kpi-eq){ grid-template-columns: 1fr; }
  }
  @media (min-width: 1025px){
    /* 右側（含本月重點等卡）加寬為 1.5x */
    #form_info{ grid-template-columns: 1fr 1.5fr; align-items:start; }
    /* 桌面版 KPI 仍維持 2 欄寬大卡 */
    #form_info .card .row:has(.kpi-eq){ grid-template-columns: repeat(2, minmax(340px, 1fr)); }
    #form_info > .card:nth-of-type(1){ grid-column: 1; grid-row: 1 / span 3; }
    #form_info > .card:nth-of-type(2),
    #form_info > .card:nth-of-type(3),
    #form_info > .card:nth-of-type(4){ grid-column: 2; }
  }
  
  /* 保證底部 tabbar 的 icon 一定出現 */
  .tabbar .tab-item .tab-ico{ display:block; font-size: 60px; line-height: 1; }

/* 分析頁：手機版專屬排版 */
@media (max-width: 1024px){
  /* 篩選列滿寬置頂（原本在左欄） */
  .data-grid{ grid-template-columns: 1fr; }
  .data-left .flt-drawer{ position: static; max-width: none; width: 100%; }
  /* 隱藏圖表、保留合計與清單 */
  #chartsBox{ display: none !important; }
  .data-right > .sumbar, .data-right > .card{ max-width: 100%; }
  /* 放大整個分析頁（300%），包含篩選與合計列 */
  #form_data{ font-size: 200%; }
  #form_data .flt-drawer,
  #form_data .sumbar{ font-size: inherit; }

  /* 修正：這些原本寫死 px 的元素，改回跟隨父層字級 */
  #form_data .flt-title,
  #form_data .date-field,
  #form_data .sum-right,
  #form_data .meta-row{ font-size: 1em !important; }
  #form_data .chips .chip,
  #form_data .segmulti .segbtn, #fltFrom,
  #form_data .sum-tag,
  #form_data .date-display{ font-size: 0.6em !important; }
  #form_data .flt-label{ font-size:0.3em !important; }

  /*Info page */
  #kpiThisMonth, #kpiMgmtPaid, #kpiUtilitiesSum, #kpiEquipment, #loanPaid, #loanTotal, #loanPct, #loanBalance, #catbar-total, #incbar-total{ font-size: 36px; font-weight:800 !important;line-height: 1.1;}

  /* 表格字級跟隨父層 */
  #form_data table{ font-size: inherit; }

  /* 手機：篩選列在左、sumbar 在右；清單在下方橫跨兩欄 */
  #form_data .data-grid{
  grid-template-columns: 1fr 1fr;
  align-items: stretch;          /* 兩者等高 */
  column-gap: 14px;              /* 兩欄間距 */
}
  #form_data .data-left{ grid-column: 1; grid-row: 1; }
  #form_data .data-left .flt-drawer{
  max-width: 75%; margin: 14px auto; height: 90%;
}
  #form_data .data-right{ display: contents; } /* 讓內部項目能當 grid 直屬子層定位 */
  #form_data .sumbar{ grid-column: 2; grid-row: 1; 
  max-width: 85%; margin: 14px auto; height: 90%;
}
  /* 清單在下方，橫跨兩欄滿寬 */
  #form_data .data-right .card{
  grid-column: 1 / -1; grid-row: 2; margin: 14px auto;max-width: 95%; }

  /* sumbar 內容改為縱向堆疊（上：chips；下：總額） */
  /* sumbar：上 chips、下 totals；中間加分隔線；移除「|」 */
  #form_data .sumbar{
    flex-direction: column; align-items: stretch; gap: 8px;
  }
  #form_data .sum-left{ order: 1; justify-content:flex-start; }
  #form_data .sum-right{
    order: 2; align-self: stretch;
    display:flex; flex-direction:column; gap:8px;
    border-top: 1px solid var(--line); padding-top: 8px;
  }
  #form_data .sum-sep{ display:none !important; } /* 移除 | */
}
  </style>