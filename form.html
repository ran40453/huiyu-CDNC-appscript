<!DOCTYPE html>
<html lang="zh-Hant-TW" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>ç¢§æŸ³è¨˜å¸³å†Š v10</title>
    <script>
      // ç”±æœ€ä¸Šå±¤æ¨¡æ¿è¨ˆç®—å¾Œå¡åˆ°å‰ç«¯ï¼ˆæ³¨æ„ï¼šé€™æ®µè¦åœ¨å…¶å®ƒæª”æ¡ˆ include ä¹‹å‰ï¼‰
      window.__CW_DEPLOY_TAG = "<?= DEPLOY_TAG ?>";
      // è‹¥ä½ è¦æš«æ™‚æ‰‹å‹•æ¨™è¨»æ¸¬è©¦ç’°å¢ƒï¼Œä¹Ÿå¯ä»¥è¦†è“‹ï¼š
      // window.__CW_DEPLOY_TAG = "TEST / staging-2025-09-03";
    </script>
 <?!= include('css'); ?>
  <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#0f0f12"  media="(prefers-color-scheme: dark)">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body class="has-tabbar">
  <div class="app">
    <!-- å³å´æŠ½å±œï¼ˆé è¨­æ”¶åˆï¼‰ -->
    <aside id="sidebar" class="sidebar" aria-hidden="true">
      <div class="sb-head">
        <div class="sb-title">æƒ å®‡ç¢§æŸ³</div>
        <button id="sbClose" class="sb-close" type="button" title="é—œé–‰">â‡¤</button>
      </div>
      <div class="sb-group">
        <button class="sb-link" data-nav="info"><strong>è³‡è¨Š</strong></button>
        <button class="sb-link" data-nav="home"><strong>è¨˜å¸³</strong></button>
        <button class="sb-link" data-nav="insights"><strong>åˆ†æ</strong></button>
        <button class="sb-link" data-nav="links"><strong>é€£çµ</strong></button>
      </div>
      <div class="sb-foot">v10 Â· iOS äº®/æš—</div>
    </aside>

    <!-- å…§å®¹å€ -->
    <main class="content">
      <div class="topbar">
        <div class="topbar-row">
          <div class="large-title">ç¢§æŸ³è¨˜å¸³å†Š <span class="subtitle" id="meta"></span></div>
          <div class="rightbar">
            <div class="theme-toggle" aria-label="ä¸»é¡Œåˆ‡æ›">
              <div class="seg-sm" role="tablist">
                <button id="thLight" class="active" type="button">äº®</button>
                <button id="thDark"  type="button">æš—</button>
              </div>
            </div>
            <button id="btnMenu" class="menu-btn" type="button">â˜° Menu</button>
          </div>
        </div>
        <div class="topbar-center">
          <div class="page-name" id="pageName">è³‡è¨Š</div>
        </div>
      </div>

      <!-- Page: Info -->
      <section id="page-info" class="wrap" hidden>
        <div class="card" style="text-align:center; padding-top:28px;">
          <!-- logoï¼šè‡ªé©æ‡‰æ¯”ä¾‹ + åœ“è§’ä¸€è‡´ -->
          <div class="logo-box">
            <img id="infoLogo" alt="logo">
          </div>

          <h1 style="font-size:clamp(28px,4.6vw,38px); margin:6px 0 4px; letter-spacing:-.02em; font-weight:800; color:var(--moss-ink);">
            æƒ å®‡ç¢§æŸ³
          </h1>

          <!-- ä¸­æ–‡åœ°å€ + è‹±æ–‡åœ°å€ï¼ˆè‹±æ–‡å¾åŸæ¨™é¡Œåˆ—æ¬ä¾†é€™è£¡ï¼‰ -->
          <div style="color:var(--muted); font-weight:600; margin-bottom:14px; line-height:1.5;">
            <div>406015 å°ä¸­å¸‚åŒ—å±¯å€è©”å®‰è¡—88è™Ÿ4æ¨“ä¹‹21</div>
            <div id="addrEn">4F-21, No. 88, Zhao'an Street, Beitun District, Taichung City 406015, Taiwan (R.O.C.)</div>
          </div>

          <div class="row" style="justify-content:center; gap:14px;">
            <div class="col" style="max-width:520px;">
              <div class="card" style="margin:0; text-align:left;">
                <div style="font-size:14px; color:var(--muted); margin-bottom:10px;">è²¸æ¬¾è³‡è¨Š</div>
                <div style="display:grid; grid-template-columns: 1fr auto; gap:10px; align-items:center;">
                  <div>å·²ç¹³è²¸æ¬¾</div>
                  <div id="loanPaid" style="font-weight:800;">â€”</div>

                  <div>ç¸½é¡æˆ¿å±‹è²¸æ¬¾</div>
                  <div id="loanTotal" style="font-weight:800;">12,000,000</div>

                  <div>é€²åº¦</div>
                  <div id="loanPct" style="font-weight:800;">â€”%</div>
                </div>

                <!-- è¦–è¦ºåŒ–é€²åº¦æ¢ -->
                <div style="margin-top:12px;height:10px;border-radius:999px; background:color-mix(in oklab, var(--muted) 12%, transparent); position:relative; overflow:hidden;">
                  <div id="loanBar" style="position:absolute; left:0; top:0; bottom:0; width:0%;
                       background:linear-gradient(90deg, var(--moss), color-mix(in oklab, var(--moss) 60%, var(--tint)));
                       border-radius:999px; box-shadow:0 6px 16px rgba(0,0,0,.08);"></div>
                </div>

                <!-- æ–°å¢ï¼šç›®å‰é¤˜é¡ -->
                <div style="display:flex; justify-content:space-between; align-items:center; margin-top:10px;">
                  <div style="color:var(--muted); font-size:14px;">ç›®å‰é¤˜é¡</div>
                  <div id="loanBalance" style="font-weight:800;">â€”</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Page: Homeï¼ˆè¡¨å–® + KPIï¼‰ -->
      <section id="page-home" class="wrap">
        <div class="card">
          <form id="f" autocomplete="off">
            <div class="row">
              <div class="col">
                <label>æ—¥æœŸ</label>
                <input type="date" name="date" required />
              </div>
              <div class="col">
                <label>é …ç›®åç¨±</label>
                <input type="text" name="title" placeholder="ä¾‹å¦‚ï¼šæˆ¿è²¸ / ç©ºèª¿å°¾æ¬¾â€¦" required />
              </div>
            </div>

            <div class="row" style="margin-top:12px;">
              <div class="col">
                <label>é …ç›®é¡åˆ¥</label>
                <select name="category" id="category" required>
                  <option value="" disabled selected>è«‹é¸æ“‡</option>
                </select>
              </div>

              <div class="col">
                <label>æ”¶å…¥ / æ”¯å‡º</label>
                <div class="seg" role="tablist" aria-label="æ”¶å…¥æˆ–æ”¯å‡º">
                  <input type="radio" id="typeOut"  name="type" value="æ”¯å‡º" checked>
                  <label for="typeOut">æ”¯å‡º</label>
                  <input type="radio" id="typeIn"   name="type" value="æ”¶å…¥">
                  <label for="typeIn">æ”¶å…¥</label>
                </div>
              </div>

              <div class="col">
                <label>é‡‘é¡</label>
                <input type="number" inputmode="numeric" step="1" min="0" name="amount" placeholder="0" required />
              </div>
            </div>

            <div class="row" style="margin-top:12px;">
              <div class="col">
                <label>ä»˜æ¬¾äºº</label>
                <select name="payer" id="payer" required>
                  <option value="" disabled selected>è«‹é¸æ“‡</option>
                </select>
              </div>
            </div>

            <div class="actions">
              <button id="submitBtn" class="btn" type="submit">æ–°å¢</button>
              <span id="msg"></span>
            </div>
          </form>
        </div>

        <div class="card">
          <h3 class="subtitle" style="margin:0 0 8px;">ç›®å‰é¤˜é¡</h3>
          <div class="ink">
            <div class="ink-card ink-income">
              <div class="ink-label">ç¸½æ”¶å…¥</div>
              <div class="ink-value" id="inkIncome">â€”</div>
            </div>
            <div class="ink-card ink-expense">
              <div class="ink-label">ç¸½æ”¯å‡º</div>
              <div class="ink-value" id="inkExpense">â€”</div>
            </div>
            <div class="ink-card ink-balance">
              <div class="ink-label">ç›®å‰é¤˜é¡</div>
              <div class="ink-value" id="inkBalance">â€”</div>
            </div>
          </div>
          <div style="margin-top:10px;">
            <button id="refreshBtn" class="btn" type="button">é‡æ–°æ•´ç†</button>
          </div>
        </div>
      </section>

      <!-- Page: Insightsï¼ˆå·¦æŠ½å±œç¯©é¸ + sticky ç¸®é«˜åœ– + æ¸…å–®ï¼‰ -->
      <section id="page-insights" class="wrap" hidden>
        <!-- å·¦å´ sort æŠ½å±œ toggle -->
        <button id="fltToggle" class="flt-toggle" type="button">â‡¥ <small>sort</small></button>

        <!-- å·¦å´æŠ½å±œ -->
        <aside id="fltDrawer" class="flt-drawer" aria-hidden="true">
          <div class="flt-title">ç¯©é¸</div>

          <div class="flt-group">
            <div class="flt-label">æ—¥æœŸå€é–“</div>
            <div class="row date-row" style="gap:8px;">
              <div class="date-field">
                <span class="date-display" id="dispFrom">â€”/â€”</span>
                <input type="date" id="fltFrom" aria-label="èµ·æ—¥">
              </div>
              <div class="date-field">
                <span class="date-display" id="dispTo">â€”/â€”</span>
                <input type="date" id="fltTo" aria-label="è¿„æ—¥">
              </div>
            </div>

            <div class="segmulti" style="margin-top:8px;">
              <button type="button" class="segbtn" data-q="this-month">æœ¬æœˆ</button>
              <button type="button" class="segbtn" data-q="all">å…¨éƒ¨</button>
            </div>
          </div>

          <div class="flt-group">
            <div class="flt-label">æ”¶å…¥ / æ”¯å‡ºï¼ˆå¯è¤‡é¸ï¼‰</div>
            <div id="segType" class="segmulti">
              <button type="button" class="segbtn active" data-type="æ”¶å…¥">æ”¶å…¥</button>
              <button type="button" class="segbtn active" data-type="æ”¯å‡º">æ”¯å‡º</button>
            </div>
          </div>

          <div class="flt-group">
            <div class="flt-label">é¡åˆ¥ï¼ˆå¯è¤‡é¸ï¼‰</div>
            <div id="chipsCat" class="chips vertical"></div>
          </div>

          <div class="flt-group">
            <div class="flt-label">ä»˜æ¬¾äººï¼ˆå¯è¤‡é¸ï¼‰</div>
            <div id="chipsPayer" class="chips vertical"></div>
          </div>
        </aside>

        <!-- sticky åœ–è¡¨ï¼ˆå·¦ï¼šåˆ†é¡é•·æ¢ï½œå³ï¼šæ™‚é–“ç´¯ç©ï¼‰ -->
        <div class="card insights-sticky" id="chartsBox">
          <h3 class="subtitle" style="margin:0 0 6px;">é¡åˆ¥åŠ ç¸½ï¼ˆå·¦ï¼šåˆ†é¡ï½œå³ï¼šæ™‚é–“ç´¯ç©ï¼‰</h3>
          <div class="chart-placeholder" id="chartPlaceholder">é»é¸é–‹å•Ÿåœ–è¡¨</div>
          <div class="grid-2-tight" id="chartsGrid">
            <div class="charts-compact"><canvas id="chartFeatured"></canvas></div>
            <div class="charts-compact"><canvas id="chartOthers"></canvas></div>
          </div>
          <div class="chart-actions">
            <button id="btnChartToggle" type="button" class="chart-toggle-btn">æ”¶åˆåœ–è¡¨</button>
          </div>
        </div>

        <!-- åˆ†æé ï¼šç¯©é¸åŠ ç¸½åˆ—ï¼ˆæ”¾åœ¨æ¸…å–®ä¸Šæ–¹ï¼‰ -->
        <div class="sumbar" id="sumBar">
          <div class="sum-left" id="sumTags"><!-- é¡åˆ¥å°æ°£æ³¡æœƒç”± JS æ³¨å…¥ --></div>
          <div class="sum-right"><span id="sumTotal">â€”</span></div>
        </div>

        <!-- æ¸…å–® -->
        <div class="card">
          <div class="meta-row">
            <div>æ¸…å–®ï¼ˆ<span id="rowCount">0</span> ç­†ï¼‰</div>
            <div id="rowsMsg" class="subtitle"></div>
          </div>
          <div style="overflow:auto;">
            <table id="tbl">
              <thead>
                <tr>
                  <th data-k="date">æ—¥æœŸ</th>
                  <th data-k="title">é …ç›®åç¨±</th>
                  <th data-k="category">é¡åˆ¥</th>
                  <th data-k="amount" class="t-right">é‡‘é¡</th>
                  <th data-k="type">æ”¶å…¥/æ”¯å‡º</th>
                  <th data-k="payer">ä»˜æ¬¾äºº</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>
      <?!= include('form_link'); ?>
    </main>
    <nav class="tabbar" role="tablist" aria-label="åº•éƒ¨å°è¦½">
      <div class="tab-inner">
        <a href="#info" class="tab-item" data-nav="info">
          <span class="tab-ico" aria-hidden="true">ğŸ </span>
          <span class="tab-label">è³‡è¨Š</span>
        </a>
        <a href="#home" class="tab-item" data-nav="home">
          <span class="tab-ico" aria-hidden="true">ğŸ§¾</span>
          <span class="tab-label">è¨˜å¸³</span>
        </a>
        <a href="#insights" class="tab-item" data-nav="insights">
          <span class="tab-ico" aria-hidden="true">ğŸ“Š</span>
          <span class="tab-label">åˆ†æ</span>
        </a>
        <button type="button" id="tabMenu" class="tab-item" data-nav="menu">
          <span class="tab-ico" aria-hidden="true">â˜°</span>
          <span class="tab-label">é¸å–®</span>
        </button>
      </div>
    </nav>
  </div>

<script>
(function(){
  function highlightTab(name){
    document.querySelectorAll('.tabbar .tab-item').forEach(function(el){
      el.classList.toggle('active', el.dataset.nav === name);
    });
  }

  function currentPageFromHash(){
    var h = (location.hash || '#info').replace('#','');
    return ['info','home','insights','links'].indexOf(h) >= 0 ? h : 'info';
  }

  // åˆå§‹èˆ‡ hash è®Šæ›´æ™‚ï¼ŒåŒæ­¥åº•éƒ¨ Tab é«˜äº®
  window.addEventListener('hashchange', function(){ highlightTab(currentPageFromHash()); });
  highlightTab(currentPageFromHash());

  // å³å´ã€Œé¸å–®ã€ï¼šæš«æ™‚å°å‘ #linksï¼ˆä¹‹å¾Œå¯æ”¹ç‚ºæ‰“é–‹æ›´å¤šåŠŸèƒ½é¢æ¿ï¼‰
  var btnMenu = document.getElementById('tabMenu');
  if (btnMenu){
    btnMenu.addEventListener('click', function(){
      location.hash = '#links';
    });
  }

  // è®“é»æ“Šä¸‰å€‹åˆ†é æŒ‰éˆ•æ™‚ä¹Ÿèƒ½æ­£ç¢ºé«˜äº®ï¼ˆé¿å…æŸäº›ç€è¦½å™¨ä¸è§¸ç™¼ hashchangeï¼‰
  document.querySelectorAll('.tabbar .tab-item[href^="#"]').forEach(function(a){
    a.addEventListener('click', function(){
      setTimeout(function(){ highlightTab(currentPageFromHash()); }, 0);
    });
  });
})();
</script>
<?!= include('form_js'); ?>
</body>
</html>